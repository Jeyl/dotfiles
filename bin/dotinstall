#!/bin/bash

set -e

## Set the pwd to the project root, so we can savely use relative path names
cd "$(dirname "$0")/.."
export DOT_DIR="$(pwd)"
echo "$DOT_DIR" >"$HOME/.dotdir"

source share/console_setup

cd dotfiles
find -type f | cut -c 3- | while read file ; do
	DST="$HOME/.$file"
	mkdir -p "$(dirname "$DST")"
	cp "$file" "$DST"
done

for f in ".i3status.conf"
do
	sed -i -e "s#--DOT_DIR--#$DOT_DIR#g" "$HOME/$f"
done

case "$S_DOMAIN" in
	"cip.ifi.lmu.de")
		rbg_fix="_local"
		;;
esac

ln -fs "$DOT_DIR/share/console_setup" "$HOME/.profile"         ## interactive & login
ln -fs "$DOT_DIR/share/console_setup" "$HOME/.bashrc$rbg_fix"  ## interactive & not login
ln -fs "$DOT_DIR/share/console_setup" "$HOME/.zshenv"          ## allways

nanorc update

if type i3-msg >/dev/null ; then
	i3-msg --quiet reload
fi